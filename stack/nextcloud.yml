version: '3'

networks:
  frontend:
    # add this if the network is already existing!
    external: true
  backend:
    external: true

services:

  nextcloud-app:
    image: nextcloud
    container_name: ${CONTNAME}
    hostname: ${CONTNAME}
    restart: unless-stopped
    volumes:
      - /portainer/${CONTNAME}/Data:/var/www/html
    environment:
      - MYSQL_PASSWORD=${DATABASE_PASSWORD}
      - MYSQL_DATABASE=${CONTNAME}
      - MYSQL_USER=${CONTNAME}
      - MYSQL_HOST="${CONTNAME}-db"
      - TZ=${TZ}
    networks:
      - frontend
      - backend

  nextcloud-db:
    container_name: "${CONTNAME}-db"
    hostname: "${CONTNAME}-db"
    image: jc21/mariadb-aria:latest
    restart: unless-stopped
    command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW
    volumes:
      - /portainer/${CONTNAME}/DB:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_PASSWORD=${DATABASE_PASSWORD}
      - MYSQL_DATABASE=${CONTNAME}
      - MYSQL_USER=${CONTNAME}
      - TZ=${TZ}
    networks:
      - backend