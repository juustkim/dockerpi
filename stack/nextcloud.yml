version: '3'

volumes:
  app:
  db:
  db-config:

networks:
  frontend: 
    external: true # add this if the network is already existing!
  backend:
    external: true # add this if the network is already existing!

services:

  nextcloud-db:
    container_name: ${CONTNAME}-db
    image: yobasystems/alpine-mariadb:latest
    restart: unless-stopped
    command: --transaction-isolation=READ-COMMITTED --binlog-format=ROW
    volumes:
      - db:/var/lib/mysql
      - db-config:/config
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_PASSWORD=${DATABASE_PASSWORD}
      - MYSQL_DATABASE=${CONTNAME}
      - MYSQL_USER=${CONTNAME}
      - TZ=${TZ}
    networks:
      - backend

  nextcloud-app:
    image: nextcloud
    container_name: ${CONTNAME}-app
    hostname: ${CONTNAME}
    restart: unless-stopped
    links:
      - ${CONTNAME}-db
    volumes:
      - app:/var/www/html
    environment:
      - MYSQL_PASSWORD=${DATABASE_PASSWORD}
      - MYSQL_DATABASE=${CONTNAME}
      - MYSQL_USER=${CONTNAME}
      - MYSQL_HOST=${CONTNAME}-db
      - TZ=${TZ}
    networks:
      - frontend
      - backend
    dns: 172.20.0.250